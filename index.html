<html>
<head>
  <title>Home</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css"
    integrity="sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container-fluid main">
    <aside class="sidebar">
      <div class="logo">
        <img src="img/logo.jpg" alt="logo">
      </div>
      <ul class="links">
        <h4>Main Menu</h4>
        <li class="active">
          <span class="material-symbols-rounded">home</span>
          <a href="#">Dashboard</a>
        </li>
        <li id="login">
          <span class="material-symbols-rounded">passkey</span>
        </li>
        <li id="pop">
          <span class="material-symbols-rounded">explore</span>
        </li>

        <li>
          <span class="material-symbols-rounded">podcasts</span>
          <a href="#">Message</a>
        </li>
        <li>
          <span class="material-symbols-rounded">settings</span>
          <a href="#">Settings</a>
        </li>
        <li class="logout-link">
          <span class="material-symbols-rounded">logout</span>
          <a href="#">Logout</a>
        </li>
      </ul><div id="player" style="margin: 0; padding: 0; visibility: hidden; height: 0; width: 0;"></div>
    </aside>

    <div class="row rrr">

      <div class="row" style="margin: 0; padding: 0;height: 60px;">
        <div class="col-8 topbar1">
          <img src="img/logo.jpg" class="dp" alt="logo" id="dp">
          <p class="displayname" id="displayname">---- -------, ------- -------</p>
        </div>

        <div class="col-4 topbar2">
          <input type="text" placeholder="Search" class="searchbar" id="searchbar">
          <button class="searchbtn" onclick="search()"><span class="material-symbols-rounded">search</span></button>
        </div>
      </div>

      <div class="row mainarea">
        <ul class="col-12 mainarea1">
          <li></li>
          <li></li>
          <li></li>
          <li></li>
          <li></li>
        </ul>
        <div class="col-9 mainarea2">
          <div class="container-fluid list">
            <div class="row songlist">
              <ul class="col-2 playlistList">
                <a href="#playlistitem1">
                  <li><span class="material-symbols-rounded">queue_music</span>&nbsp;&nbsp;Siddant</li>
                </a>
                <a href="#playlistitem2">
                  <li><span class="material-symbols-rounded">queue_music</span>&nbsp;&nbsp;Mahajan</li>
                </a>
              </ul>

              <div class="col-10" style="overflow-y: hidden;height: 100%; margin: 0;padding: 0;">
                <ul class="playlistitem" id="playlistitem1">
                  <li>
                    <img src="img/logo.jpg" class="aart" alt="logo">
                    <div class="con">
                      <p class="title" id="title">Siddant Dhananjay Mahajan</p>
                      <p class="artist1">T-Series</p>
                    </div>
                  </li>
                </ul>

                <ul class="playlistitem" id="playlistitem2">
                  <li>
                    <img src="img/logo.jpg" class="aart" alt="logo">
                    <div class="con">
                      <p class="title" id="title">FAIT Music</p>
                      <p class="artist1">T-Series</p>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="col-3 mainarea3">
          <div class="container-fluid player">
            <div class="container-fluid" style="margin: 0; padding: 0; height: calc(100% - 50px); overflow: hidden;">
              <div class="container-fluid player-inner" id="playerX1">
                <img src="img/test.jpg" class="albumart" id="albumart">
                <p class="song" id="song">Song title here</p>
                <p class="artist" id="artist">Artist title here</p>
                <input type="range" min="0" max="100" value="50" class="seekslider" id="seek-bar" onchange="seekTo(this.value)"/>
                <div class="container-fluid time">
                  <p class="start" id="start">00:00</p>
                  <p class="end" id="end">00:00</p>
                </div>
                <div class="container-fluid controls">
                  <button class="prev"><span class="material-symbols-rounded"
                      style="font-size: 30px;">skip_previous</span></button>
                  <button class="play" id="play"><span class="material-symbols-rounded"
                      style="font-size: 30px;">play_arrow</span></button>
                  <button class="next"><span class="material-symbols-rounded"
                      style="font-size: 30px;">skip_next</span></button>
                </div>
                <input onchange="changeVolume(this.value)" id="volSlider" type="range" value="100" min="0" max="100" class="volume" />
              </div>

              <div class="container-fluid player-inner" id="queueX1">
                <button id="test">Hit</button>
              </div>

              <div class="container-fluid player-inner" id="lyricsX1">
                Lyrics
              </div>
            </div>
            <div class="container-fluid btm-layer">
              <ul class="btm-layer1">
                <li><button id="playerX" class="active">Player</button></li>
                <li><button id="queueX">Queue</button></li>
                <li><button id="lyricsX">Lyrics</button></li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="script.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <script>
    var player;
    var duration;
    var playPauseButton;
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function search() {
      var x = document.getElementById('searchbar').value;
      player.loadVideoById(x, 0, 'large');
      player.playVideo();  // Start playing immediately
      const pauseButton = document.getElementById('play');
      pauseButton.innerHTML = '<span class="material-symbols-rounded" style="font-size: 30px;">pause</span>';

    }

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '0',
          width: '0',
          videoId: '',
          playerVars: {
            'autoplay': 1, 'controls': 0, 'enablejsapi': 1
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

    
    function seekTo(value) {
      const duration = player.getDuration();
      const seekTime = (value / 100) * duration;
      player.seekTo(seekTime, true);
    }

    // 4. The API will call this function when the video player is ready.
    function onPlayerReady(event) {
      setInterval(updateSeekSlider, 500);  // Update the seek slider every 500ms
      event.target.playVideo();
      playPauseButton = document.getElementById('play');
      playPauseButton.addEventListener('click', function () {
        if (player.getPlayerState() == YT.PlayerState.PLAYING) {
          player.pauseVideo();
        } else {
          player.playVideo();
        }
      });
      

    }

    var done = false;
    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.PLAYING && !done) {
        done = true;
      }
      if (event.data === YT.PlayerState.PLAYING) {
        updateSeekSlider();
      }

      const pauseButton = document.getElementById('play');
      pauseButton.addEventListener('click', () => {
        if (event.data === YT.PlayerState.PLAYING) {
          player.pauseVideo();
          pauseButton.innerHTML = '<span class="material-symbols-rounded" style="font-size: 30px;">play_arrow</span>';
        }
        else if (event.data === YT.PlayerState.PAUSED) {
          player.playVideo();
          pauseButton.innerHTML = '<span class="material-symbols-rounded" style="font-size: 30px;">pause</span>';
        }
      });

      var videoTitle = player.getVideoData().title;
      const songTitle = document.getElementById('song');
      if(videoTitle === null || videoTitle === '')
      {
        song.innerHTML = "null";
      }
      else{
        if(videoTitle.length > 33){
          videoTitle = videoTitle.substring(0,30) + '..';
        }
        
        song.innerHTML = videoTitle;
      }
      
      console.log(player.getVideoData());
      var author = player.getVideoData().author;
      const chann = document.getElementById('artist');
      if(author === null || author === '')
      {
        chann.innerHTML = 'null';
      }
      else{
        chann.innerHTML = author;
      }

      const aart = document.getElementById('albumart');
      aart.src=`https://img.youtube.com/vi/${ player.getVideoData().video_id}/sddefault.jpg`;

    }


    // Update the seek slider with the current time and total duration
    function updateSeekSlider() {
      const currentTime = player.getCurrentTime();
      const duration = player.getDuration();
      const percent = (currentTime / duration) * 100;
      document.getElementById('seek-bar').value = percent;

      const currentMinutes = Math.floor(currentTime / 60);
      const currentSeconds = Math.floor(currentTime % 60);
      const durationMinutes = Math.floor(duration / 60);
      const durationSeconds = Math.floor(duration % 60);

      // Display time in MM:SS format
      document.getElementById('start').textContent = `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')}`;
      document.getElementById('end').textContent = `${durationMinutes}:${durationSeconds.toString().padStart(2, '0')}`;
    }


    function stopVideo() {
      player.stopVideo();
    }

    function changeVolume(vol){
        player.setVolume(vol);
    }
  </script>

  <script>
    var login = document.getElementById('login');
      login.addEventListener('click', function () {
        Authenticate();
      });
    function Authenticate() {
      console.log('Authenticate called');
      const clientId = '751698155813-qts0dtps5okkv5d7bbvo4v9j33udra9q.apps.googleusercontent.com';
      const redirectUri = 'https://siddantmahajan.github.io/music/';
      const scope = 'https://www.googleapis.com/auth/youtube.force-ssl';
      const responseType = 'token';
      const url = `https://accounts.google.com/o/oauth2/v2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}`;
      window.location.href = url;
      
    }
// Run this on page load
window.onload = function () {
  const accessToken = getAccessTokenFromUrl();
  if (accessToken) {
    console.log("Access token received:", accessToken);
    localStorage.setItem("accessToken", accessToken);

    // Clean URL so the token hash isn’t visible
    window.history.replaceState({}, document.title, window.location.pathname);
  }
};

var pop = document.getElementById("pop");
pop.addEventListener("click", function () {
  const accessToken = localStorage.getItem("accessToken");
  if (!accessToken) {
    alert("Please login first!");
    return;
  }
  getUserInfo();
});

function getAccessTokenFromUrl() {
  console.log("getAccessTokenFromUrl called");
  const urlParams = new URLSearchParams(window.location.hash.substring(1));
  return urlParams.get("access_token");
}

function getUserInfo() {
  console.log("getUserInfo called");
  const accessToken = localStorage.getItem("accessToken");
  if (!accessToken) {
    console.error("No access token found");
    return;
  }

  fetch("https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true", {
    headers: {
      Authorization: `Bearer ${accessToken}`,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      if (!data.items || !data.items.length) {
        console.error("No channel found or invalid token");
        return;
      }
      const channel = data.items[0];
      document.getElementById("displayname").innerHTML = `Good Morning ${channel.snippet.title}`;
      document.getElementById("dp").src = channel.snippet.thumbnails.default.url;
    })
    .catch((error) => {
      console.error("Error fetching user info:", error);
    });
}
  </script>
</body>

</html>















